<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fsautoproc: fsautoproc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">fsautoproc
   </div>
   <div id="projectbrief">Basic file transformation automation management utility</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">fsautoproc </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><code>fsautoproc</code> is a basic C utility for when:</p>
<ul>
<li>you have a large directory of various files</li>
<li>that when a file matching any number of regex patterns is added, modified, removed, or left unchanged,</li>
<li>you want to run a series of commands (likely using the filepath as an argument)</li>
</ul>
<p>e.g. you have a large folder of PDFs that is published to a web server. When a new PDF is added, or an existing PDF is modified, you wish to strip any unnecessary file metadata and generate a thumbnail image. If the PDF file is removed, its thumbnail is removed as well.</p>
<p><code>fsautoproc</code> does not:</p>
<ul>
<li>re-generate broken file system state (e.g. you manually delete a generated thumbnail, <code>fsautoproc</code> can detect the removal and trigger a command to re-generate it, but you must configure the commands to do so)</li>
</ul>
<p>Before using, consider:</p>
<ul>
<li><code>fsautoproc</code> is not a daemon. It is intended to be run as a cron job or a systemd timer.</li>
<li><code>fsautoproc</code> is not a live file system watcher. It scans for modified files on each run.</li>
<li><b>This is a C utility invoking shell commands. Be mindful of the serious security implications of running arbitrary shell commands and use restricted user accounts.</b></li>
<li>Like most C code you find on the internet, <code>fsautoproc</code> was built for a specific hobby purpose with arbitrary C opinions and may not be reasonable for your use case.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Building</h1>
<p><code>fsautoproc</code> is built with CMake. You will need a C11 compiler and CMake installed. The utility is primarily written for use on Linux and BSD systems (including macOS). It may work on Windows with WSL or Cygwin, but this is currently untested.</p>
<p>C11 is used for basic atomic boolean operations when scheduling work across threads. C99 compatibility can be achieved by providing a <code>stdatomic.h</code> compatible stub header for your platform.</p>
<ol type="1">
<li>Clone the repository and its submodules: <code>git clone --recursive <a href="https://github.com/Cryptkeeper/fsautoproc">https://github.com/Cryptkeeper/fsautoproc</a></code></li>
<li>Build the CMake project with <code>cmake -B build</code></li>
<li>Compile the project with <code>cmake --build build</code></li>
<li>Optionally install binary using <code>make install</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md2"></a>
Dependencies</h2>
<p>Git submodules provide:</p>
<ul>
<li><a href="https://github.com/DaveGamble/cJSON">cJSON</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Usage</h2>
<div class="fragment"><div class="line">$ fsautoproc -h</div>
<div class="line">Usage: fsautoproc -i &lt;file&gt;</div>
<div class="line"> </div>
<div class="line">Options:</div>
<div class="line">  -c &lt;file&gt;   Configuration file (default: `fsautoproc.json`)</div>
<div class="line">  -i &lt;file&gt;   File index write path</div>
<div class="line">  -j          Enable including ignored files in index</div>
<div class="line">  -l          List time spent for each command set</div>
<div class="line">  -p          Pipe subprocess stdout/stderr to files</div>
<div class="line">  -s &lt;dir&gt;    Search directory root (default: `.`)</div>
<div class="line">  -t &lt;#&gt;      Number of worker threads (default: 4)</div>
<div class="line">  -r &lt;file&gt;   Trace which command sets match the file</div>
<div class="line">  -u          Skip processing files, only update file index</div>
<div class="line">  -v          Enable verbose output</div>
<div class="line">  -x &lt;file&gt;   Exclusive lock file path</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
Basic Configuration</h2>
<p><code>example.fsautoproc.json</code> provides a basic example configuration file. The configuration file is a JSON array of objects, each object representing a desired "action" at a grouping level of your choosing. Each action object has the following properties:</p><ul>
<li><code>description</code> (string): An optional, brief string describing the action (for logging purposes when used with the <code>-l</code> flag)</li>
<li><code>patterns</code> (array of strings): An array of regex patterns to match against file paths (regex behavior may vary by platform, see <code>man 3 regcomp</code> for details), a file must match at least one pattern to trigger the action</li>
<li><code>commands</code> (array of strings): An array of commands to execute when a file matching a pattern is detected (commands are executed in order, command execution behavior may vary by platform, see <code>man 3 system</code> for details)</li>
<li><code>on</code> (array of strings): An array of file events on which to trigger the action for a file (<code>new</code> for new files, <code>del</code> for deleted files, <code>mod</code> for modified files, <code>nop</code> for unmodified files)</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
Command Execution</h3>
<p>When executing a command (or a series of commands), the commands are executed in configured order. The parent process is forked, and the child process executes the command using <code>system(3)</code>. The parent process waits for the child process to complete before continuing. If a command fails (i.e. returns a non-zero exit status), the parent process logs the failure and continues to the next command.</p>
<p>The path of the file that triggered the command is available to the command as an environment variable, <code>FILEPATH</code>.</p>
<p>If <code>-p</code> is enabled, the child process redirects its stdout and stderr to files in the current working directory. The files are named <code>stdout.&lt;thread #&gt;.log</code> and <code>stderr.&lt;thread #&gt;.log</code>, respectively.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Logging Symbols</h3>
<p>fsautoproc uses a symbol table when logging file changes and program status. This minimizes the amount of direct output and improves searchability. Symbols denote a basic file change being detected, and letters indicate program behavior status (i.e. the result of detecting those basic file changes).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Symbol   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[+]</code>   </td><td class="markdownTableBodyNone">A new file was created    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[*]</code>   </td><td class="markdownTableBodyNone">A file was modified    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[-]</code>   </td><td class="markdownTableBodyNone">A file was deleted/removed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[j]</code>   </td><td class="markdownTableBodyNone">A file was ignored/considered junk    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[n]</code>   </td><td class="markdownTableBodyNone">A file was not detected as modified    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[s]</code>   </td><td class="markdownTableBodyNone">A directory is being scanned    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>[x]</code>   </td><td class="markdownTableBodyNone">A system command is being invoked    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[!]</code>   </td><td class="markdownTableBodyNone">An error has occurred   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md7"></a>
Locking</h3>
<p><code>fsautoproc</code> uses a single, exclusive file lock to prevent multiple instances of the program from running simultaneously within the same search ("working") directory. The lock file is created in the working directory by default, but can be specified via the <code>-x</code> flag. The lock file is removed when the program exits. Should the program crash or exit unexpectedly, the lock file may remain and must be manually removed. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
